\documentclass[12pt,letterpaper]{article}
\usepackage{preamble}

\newcommand\course{GENETIS}
\newcommand\hwnumber{June 2023}

\begin{document}
\tableofcontents

% June 1
\section{Thu}
\subsection{Bash}
\begin{enumerate}
  \item A little bit of Bash each day keeps the doctor away.
    In the main loop, around line 140, we have
    \begin{verbatim}
      read -p "Starting generation ${gen} at location ${state}.\
                 Press any key to continue... " -n1 -s  
    \end{verbatim}
    Option "-p <prompt>" outputs the "prompt" string before reading user input.\\
    Option "-n <number>" returns after reading the specified "number" of chars.\\
    Option "-s" does not echo the user's input.
\end{enumerate}

% June 2
\section{Fri}
\textit{On a flight home. Didn't do much except started going over Part B1 again}

% June 3
\section{Sat}
\subsection{Meeting with Julie}
\begin{enumerate}
  \item The meeting this Wednesday was cancelled. In the meantime, Julie
    suggests reading the Appendix and her candidacy paper.
    I have largely finished reading the relevant
    part of the Appendix, so the rest of this week will most likely be spent reading
    the candidacy paper and checking out the "Loop Parts" in more detail.
  \item Part B1 second pass: will also check out the job submission script 
    this time around (final line of "Part_B_GPU_job_1.sh", but still not going
    to look into the xmacros).
\end{enumerate}

\subsection{Regex}
\begin{enumerate}
  \item Started reading about regular expression, although perhaps not directly relevant
    to anything.
\end{enumerate}

% June 4
\section{Sun}
\subsection{Meeting with Julie}
\begin{enumerate}
  \item Currently a bit confused by the job submission script "GPU_XF_job.sh"
  \item I think this is because I am not familiar enough with the file structure yet.
  \item Also, I am not entirely sure what the "individual number" is for in this script.
\end{enumerate}

% June 5
\section{Mon}
\subsection{Meeting with Julie}
\label{65S1}
\begin{enumerate}
  \item Still on the job submission script of "Part B1". I am confused about when
    exactly are the "indiv_parent_dir" created 
    (the ones in \$"XFproj/Simulations")
\end{enumerate}
\subsection{SLURM}
  \textbf{Filename replacement} are as follows:
\begin{enumerate}
  \item "%x" - Job name, which can be given as \texttt{----job-name=<name>}
  \item "%a" - Job array ID (index) number
  \item "%A" - Job Array's master job allocation number
  \item More options here: \url{https://slurm.schedmd.com/sbatch.html}
\end{enumerate}

\noindent Note that the following are not the same:
\begin{enumerate}
  \item \$"SLURM_ARRAY_JOB_ID": this is the "%A" from above
  \item \$"SLURM_ARRAY_TASK_ID": this is the index ("%a" from above)
\end{enumerate}


% June 6
\section{Tue}
\subsection{Meeting with Julie} 
\begin{enumerate}
  \item Started reading Julie's candidacy paper.
\end{enumerate}

% June 7
\section{Wed}
\subsection{Meeting with Julie}
\begin{enumerate}
  \item Read everything aside from Chapter 5.
  \item \textbf{TODO:} Go over Chapter 3 again before reading chapter 5.
  \item Ask Julie about Figure 6,7 8 and 9 (a discussion on all of chapter 3.1.2 if
    possible)
  \item \textbf{Zenith Angle:} The angle at which the muon traveled into the
    IceCube detector, with respect to the vertical. Source:
    \url{https://user-web.icecube.wisc.edu/~krosenau/index.html}

\end{enumerate}

\subsection{Bash}
\begin{enumerate}
  \item A backtick is not a quotation mark. Instance: "Part_B_GPU_job1.sh" line 37
    \begin{verbatim}
      for i in `seq 1 $NPOP`
    \end{verbatim}
    Everything we type inside the backticks is executed before the main command
    (such as "chown"), and the output of the backticked-command is then read by
    the main command
\end{enumerate}

% June 8
\section{Thu}
\subsection{Meeting with Julie}
\begin{enumerate}
  \item Regarding Part \ref{65S1} of the June 5th entry, from Alex: 
    \begin{quote}
    those are created by XF. Itâ€™s like a backend thing, we never make them
    ourselves but by virtue of simulating antennas they get made by XF as the
    location to store the antenna simulation data
    \end{quote}
    In other words, we do not ourselves "mkdir" the \$"indiv_dir_parent".

  \item Meeting with Julie today moved to Monday next week.

  \item \st{It seems unlikely to be a bug given how long this script has been used,
    but I am getting an error from the for loop through all frequencies in
    freqlist. Will ask Alex about it.}
    I'm an indiot. I need to initialize \$"GeoFactor" first.

  \item Finished "Loop_Parts/Part_B1" second pass, moving on to "Part_B2". Adding line
    breaks in the process; \textbf{Be careful with the trailing whitespace!}
    \textit{Mayhap it's better to just leave them as single long lines?}

  \item \textbf{TODO:} sometime in the future I'll need to figure out what 
    "simulation_PEC.xmacro" and "output.xmacro" do to really understand what "Part_B1" 
    and "Part_B2" are about.
\end{enumerate}

% June 9
\section{Fri}
\subsection{Meeting with Julie}
\begin{enumerate}
  \item \st{Probably trivial, but it seems like the uan files are already being moved
    to the correct directory at the end of Part\_B2, so I am not sure why we do it
    again at the beginning of Part\_C.}
  \item One of the "mv" command might be extra; will check with Alex.
  \item "Part_C" second pass: digging into the python codes; should be able to finish
    by tomorrow.
\end{enumerate}
\subsection{Bash}
\begin{enumerate}
  \item The dollar sign works inside the double quotes so there is no need for string
    concatenation in the example below:
    \begin{verbatim}
      $a=2;$b=2
      echo "a * b = $(($a*$b))"
    \end{verbatim}
    The above outputs "a * b = 4". Note that the \$((...)) part is for arithmetics.
  \item At some point I should try to figure out exactly what double quotes are for in
    shell scripts; they seem to be more than just strings?
    
\end{enumerate}

% June 10
\section{Sat}
\subsection{Meeting with Amy}
\begin{enumerate}
  \item Get in touch with Nicholas to see what he's up to.
  \item Go to Monday's collaboration meeting this week if possible to see if there's a 
    project for me.
\end{enumerate}

\subsection{Python}
\subsubsection{XFintoARA.py}
\begin{enumerate}
  \item instead of using the "%"'s for string interpolation, we could use "f-strings".
  \item inside the curly braces we can call variables, for instance \{"g.WorkingDir"\}
    in line 66:
    \begin{verbatim}
         uanName = f'{g.WorkingDir}/.../{g.gen}_{indiv}_{freqNum}.uan'  
    \end{verbatim}
    
  \item The "g" above is from line 102: "g = parser.parse_args()"
  \item "Line 73": "mat = [["``0'' "for x in range(n)] for y in range(m)]" is simply 
    python's way to do "mat=zeros(m,n)" in Matlab. ("List Comprehension")
\end{enumerate}

% June 11
\newpage
\setcounter{section}{11}

% June 12
\section{Mon}
\subsection{Python}
\subsubsection{XFintoARA.py}
The following pertains "line 81 \& 82"
\begin{enumerate}
  \item "line 81" first turns the third entry in the list "lineList" into a float.
  \item "line 82" contains the following: \verb|"%.2f" % 10| which turns "10"
    into "10.00". This is NOT modulo operation; this is probably more like string 
    interpolation.
  \item Mostly finished reading this python script. Moving on to "Part D" tomorrow.

\end{enumerate}
\subsubsection{General}
\begin{enumerate}
  \item To access the "help" message of "argparse"'s "add_argument" function,
    one can run the command \verb|python3 <filename>.py -h| at the terminal
  \item For more info on the "argparse" module one can look through the
    documentation of "argparse" on \url{
      https://docs.python.org/3/library/argparse.html 
    } and the tutorial at \url{
      https://towardsdatascience.com/
      a-simple-guide-to-command-line-arguments-with-argparse-6824c30ab1c3
    }
  \item \st{Reviewed file opening (with open, etc)}
  \item mode "w" and "w+": "w" is write whereas "w+" is read and write
  \item apparently with python3, when using "os.chmod" one needs to add "0o" (zero-oh)
    in front of "777" to grant all read-write-execute, etc. For instance:\\
    \verb|os.chmod("<filename>", 0o770)|\\
    This is because
    \begin{quote}
      In unix conventions, written numbers are assumed to be decimal unless they are 
      prefixed with a "0x" (or "0X") in which case they are hexadecimal 
    \end{quote}
    (\url{https://stackoverflow.com/questions/32729309/
    what-is-the-purpose-of-the-octal-digit-0-permission})
    and according to the error message we ``use an 0o prefix for octal integers''.
\end{enumerate}

% June 13
\section{Tue}
\subsection{Meeting with Julie}
\begin{enumerate}
  \item Meeting with Julie today didn't happen.
  \item Around line 24 of "Part_D1_Array.sh" the comment says to ``make a directory
    to hold the AraSim output and error files  \textit{for each generation}'' but it
    seems like we are only making the directory for the zeroth gen?
\end{enumerate}
\subsection{Bash}
\begin{enumerate}
  \item option -"e" of "sed" allows for multiple commands at once; for instance,\\
    \verb|sed -e "s/world/universe/" -e "s/hello/goodbye/" ./temp > ./newtemp|\\
    first replaces the word ``world'' in "temp" with ``universe'' and then ``hello''
    with ``goodbye'' and then pipe these changes to a new file "newtemp".
\end{enumerate}

% June 14
\section{Wed}
\subsection{Meeting with Julie}
\begin{enumerate}
  \item Continuing "Part_D1" second pass. 
  \item Looking into the job submission script "Batch_Jobs/AraSimCall_Array.sh"
  \item Sort of annoying, but it seems like SLURM directives simply cannot be broken 
    into multiple lines with backslash, so I'll just leave them.
  \item \st{what do num and seed in AraSimCall\_Array.sh refer to?} "Seed" is
    defined at the very beginning of the main loop and passed to the scripts
    along the way. See page 155 (Appendix A) of Julie's dissertation.
  \item Note: haven't looked into "setup.txt" yet
\end{enumerate}

\subsection{AraSim Job Submission Script}

\subsubsection{AraSimCall\_Array.sh}
\begin{verbatim}
#!/bin/bash
## This job is designed to be submitted by an array batch submission
## Here's the command:
## sbatch --array=1-NPOP*SEEDS%max --export=ALL,(variables) AraSimC...
#SBATCH -A PAS1960
#SBATCH -t 18:00:00
#SBATCH -N 1
#SBATCH -n 8
#SBATCH --output=/fs/ess/PAS1960/BiconeEvolutionOSC/BiconeEvolution/cur...
#SBATCH --error=/fs/ess/PAS1960/BiconeEvolutionOSC/BiconeEvolution/cur...

source /fs/ess/PAS1960/BiconeEvolutionOSC/new_root/new_root_setup.sh
cd $AraSimDir
num=$(($((${SLURM_ARRAY_TASK_ID}-1))/${Seeds}+1)) 
seed=$(($((${SLURM_ARRAY_TASK_ID}-1))%${Seeds}+1))
echo a_${num}_${seed}.txt

chmod -R 777 $AraSimDir/outputs/
./AraSim setup.txt ${SLURM_ARRAY_TASK_ID} $TMPDIR a_${num}.txt > \
 $TMPDIR/AraOut_${gen}_${num}_${seed}.txt
cd $TMPDIR
echo "Let's see what's in TMPDIR:"
ls -alrt 

echo $gen > $TMPDIR/${num}_${seed}.txt
echo $num >> $TMPDIR/${num}_${seed}.txt
echo $seed >> $TMPDIR/${num}_${seed}.txt

mv AraOut.setup.txt.run${SLURM_ARRAY_TASK_ID}.root\
 $WorkingDir/Antenna_Performance_Metric/AraOut_${gen}_${num}_${seed}.root
mv AraOut_${gen}_${num}_${seed}.txt $WorkingDir/Antenna_Performance_Metric/
mv ${num}_${seed}.txt $WorkingDir/Run_Outputs/$RunName/AraSimFlags

## This part appears unnecessary now
: << 'END'
...
...
END
\end{verbatim}

\subsubsection{AraSimCall\_Array.sh: my attempt}
This is an attempt to understand "AraSimCall_Array.sh". My own edited version of
the job submission script as attached at the end of this section. Run-on lines
are mainly just SLURM directives which are unimportant here, so they are
ignored here in the log.
\begin{enumerate}
  \item This is for "line 15". 
    There's really no need to start \$"SLURM_ARRAY_TASK_ID" at $1$, but if that's 
    what we've been doing then I'll leave it for consistency.
    That is, we could have submitted the job array analogous to \\
      \verb|   sbatch --array=0-8%4 foo.sh| \\
    in which case the first index would have been $0$.
\end{enumerate}

% June 15
\section{Thu}
\subsection{AraSim Job Submission Script}
\subsubsection{AraSimCall\_Array.sh: my attempt}
\begin{enumerate}
  \item "Seeds" is the number of AraSim jobs of an individual. So "num" on "line 15" is
    essentially just (ignoring the pesky index issue) "index" divided by "Seeds".
  \item As an example, consider a task 33 in the array of tasks. Suppose "Seeds" is 8; 
    that is, for each antenna, we do 8 AraSim runs. Since $33-1=32$ divided by 8 is 4,
    and then we add one to get $5$, "num" in this case is 5. In other words, task 33 is
    a task for antenna \textbf{num}ber 5.
  \item Similarly, right below "num", "seed" refers to the ``seed index'' for that 
    particular antenna. Continuing with the example above, task 33 will be seed number
    1 of antenna 5 (start counting from 1, as usual).
  \item Pretty sure "line 16": \verb|echo a_${num}_${seed}.txt| is
    unnecessary, and the file name being "echo"ed is probably a typo as well. 
  \item Line 18 is also extra? Seems like we are not using this directory anymore?
  \item "Line 19" is likely the line that says ``run AraSim'' (with the appropriate
    setup and parameters) and then redirecting the output of the run to the (local)
    scratch space of the cluster, ie. \$"TMPDIR". (see osc documentation regarding 
    parallel and local scratch space. Basically, "TMPDIR" is the fastest.)
  \item "Line 26" is like another ``SaveState'' file.
  \item "Line 30" to "33" move the AraSim output files from the scratch space back to
    the directories under "GE60".
\end{enumerate}

\subsection{Meeting with Julie}
\begin{enumerate}
  \item Meeting with Julie today rescheduled to same time tomorrow.
  \item Finished going through the job submission script; back to "Part_D1"
  \item Skipping the "DEBUG_MODE" of "Part_D1" for now.
  \item Changed "line 98 and 99" of "Part_D1" to use \$"WorkingDir" to shorten the lines.
\end{enumerate}


% June 16
\section{Fri}
\subsection{Birefringence Resources from Justin}
Putting these here because apparently Slack hides messages older than 90 days. Boo.
\begin{enumerate}
  \item Amy's paper: \url{https://arxiv.org/abs/2110.09015}
  \item Paper by a collaboration member who studies the birefringence in ice:
    \url{https://arxiv.org/abs/1910.01471}
  \item ``[A] decent paper on the theory, but it's a little math heavy'':\\
    \url{https://link.springer.com/article/10.1007/s00371-011-0619-2}\\
    \url{https://arxiv.org/abs/2110.09015}\\
    \url{https://arxiv.org/abs/1910.01471}
\end{enumerate}

\subsection{Meeting with Julie}
\subsubsection{Notes from today's meeting}
\begin{enumerate}
  \item hpol -- I will probably be using AraSim as is, without having to modify its code.
  \item Dylan built the PUEO software by modifying PAEA; Julie had a to-do list
    of instruction for him to do it which she will modify and send to me.
  \item Birefringence -- Julie said that it sounds like what Amy wants is for hpol to be
    optimized for birefringence (?), but I don't need to worry about learning
    all about birefringence for now, since I will be mainly just working on
    scripts of the Loop.
  \item Charged current interaction 
    \begin{align*}
      \overline{\nu}_{l} + N \to l^{\pm} + X
    \end{align*}
    The lepton people see is usually muon because it is much more stable than tau 
    (longer lifetime). We don't see electrons either because they just get reabsorbed
    immediately into the ice atoms. (Consequently, muons produce tracks whereas
    the other two create spheres)
  \item Julie recommends Dick, Chris Hirata, and Antonio Boveia for candidacy committee.
\end{enumerate}

\subsubsection{Second pass of the Loop continued}
\begin{enumerate}
  \item Continuing with "Part_D1_Array.sh"
  \item As reported a few weeks ago on Slack, "line 116" will never be executed.
    Alex set the impossible condition to keep the code, but I'll just comment it out.
  \item finished "Part_D1", moving on to "Part_D2".
\end{enumerate}

\subsection{Bash}
\begin{enumerate}
  \item be sure not to include whitespace when assigning values to variables in bash.
    For instance, "a=2" is correct but not "a = 3".
  \item Example usage of "expr": \verb|totPop=$( expr $NPOP \* $Seeds )|
    \textit{Note the whitespace! It matters here whether or not there are spaces around
    the multiplication operator}.
  \item But what is the difference between "expr" and simply using double parentheses?
    For instanace \verb|totPop=$(( $NPOP * $Seeds ))|
    (in this case it seems like bash doesn't care as much about the whitespace around
    "*")?
\end{enumerate}

% June 17
\section{Sat}
\subsection{Meeting with Julie}
\subsubsection{Part\_D2\_Array.sh Second Pass}
\begin{enumerate}
  \item Might be able to shorten "Line 22":
    \begin{verbatim}
  nFiles=$(ls -1 --file-type ../AraSimConfirmed | grep -v '/$' | wc -l)
    \end{verbatim}
    using just "ls | wc -l". Will test this tomorrow.
  \item Option "1"(one) of "ls" ``[forces] output to be one entry per line''
  \item \texttt{--file-typ} makes it so that all the directories end with a "/", and
    soft links end with a "@", etc. \url{https://stackoverflow.com/questions/
    51952975/what-is-the-purpose-of-file-type-in-ls-command}
    Files don't have anything attached.
  \item Thus, as an example, inside \$"WorkingDir/Run_Outputs/2023_02_20_Symmetric_Run",
    if we issue "ls" we get
    \begin{verbatim}
2023_02_20_Symmetric_Run.xf  Fitness_Scores_RG.png  uan_files
Antenna_Images               FScorePlot2D.png       Veffectives_RG.png
AraOut                       Gain_Plots             Veff_plot.png
AraSimConfirmed              Generation_Data        Violin_Plot.png
AraSim_Errors                GPUFlags               XF_Errors
AraSimFlags                  Root_Files             XFGPUOutputs
AraSim_Outputs               runDate.txt            XF_Outputs
Evolution_Plots              run_details.txt
    \end{verbatim}
    and with "ls -1" we have
    \begin{verbatim}
2023_02_20_Symmetric_Run.xf
Antenna_Images
AraOut
AraSimConfirmed
AraSim_Errors
AraSimFlags
AraSim_Outputs
Evolution_Plots
Fitness_Scores_RG.png
FScorePlot2D.png
Gain_Plots
Generation_Data
GPUFlags
Root_Files
runDate.txt
run_details.txt
uan_files
Veffectives_RG.png
Veff_plot.png
Violin_Plot.png
XF_Errors
XFGPUOutputs
XF_Outputs
    \end{verbatim}
    Lastly, with "ls -1 --file-type" (on OSC, not on Mac), we get
    \begin{verbatim}
2023_02_20_Symmetric_Run.xf/
Antenna_Images/
AraOut/
AraSimConfirmed/
AraSim_Errors/
AraSimFlags/
AraSim_Outputs/
Evolution_Plots/
Fitness_Scores_RG.png
FScorePlot2D.png
Gain_Plots/
Generation_Data/
GPUFlags/
Root_Files/
runDate.txt
run_details.txt
uan_files/
Veffectives_RG.png
Veff_plot.png
Violin_Plot.png
XF_Errors/
XFGPUOutputs/
XF_Outputs/
    \end{verbatim}
  \item option "v" of "grep" is ``invert-match'', which acts like a "not"-gate. It 
    selectes all entries that do not match. In this case we are trying to match
    all entries that has a forward slash "/" right before the end-of-line
    character \verb|$|; that is, we are trying to match all the directories.
    And then, "v" makes sure that we select everything that is not a directory,
    ie. files. Finally, we pipe it to "wc -l" to count as usual.
  \item I'll check with Alex to see if we really need to be this careful, because in \\
    "Part_B_GPU_job2_asym_array.sh" "line 56" it seems like we decided to simply use \\
    "ls | wc -l", which is much cleaner.
\end{enumerate}

% June 18
\section{Sun}
\subsection{Meeting with Julie}
\subsubsection{Part\_D2\_Array.sh Second Pass Continued}
\begin{enumerate}
  \item Regarding the "for" loop around "line 28", consider the following script:
    \begin{verbatim}
#!/bin/bash
cd ~/Desktop/temp

for file in *
do 
  echo $file
done
    \end{verbatim}
    If there is \textit{no} file inside "temp/", then the output would be "*". This is
    what the comment around "line 32" is talking about.
\end{enumerate}
% June 19
% June 20
% June 21
% June 22
% June 23
% June 24
% June 25
% June 26
% June 27
% June 28
% June 29
% June 30
\end{document}
